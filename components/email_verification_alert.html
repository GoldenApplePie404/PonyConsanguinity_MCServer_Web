<!-- 邮箱验证提示条 -->
<div id="emailVerificationAlert" class="email-verification-alert" style="display: none;">
    <div class="alert-content">
        <div class="alert-icon">⚠️</div>
        <div class="alert-message">
            <strong>您的邮箱尚未验证</strong>
            <span>部分功能受限，请验证邮箱以使用全部功能</span>
        </div>
        <div class="alert-actions">
            <button id="verifyEmailBtn" class="btn btn-primary btn-sm">立即验证</button>
            <button id="dismissAlertBtn" class="btn btn-secondary btn-sm">稍后</button>
        </div>
    </div>
</div>

<style>
    .email-verification-alert {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        padding: 15px 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        z-index: 9999;
        animation: slideDown 0.3s ease-out;
    }
    
    @keyframes slideDown {
        from {
            transform: translateY(-100%);
        }
        to {
            transform: translateY(0);
        }
    }
    
    .alert-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .alert-icon {
        font-size: 20px;
        flex-shrink: 0;
    }
    
    .alert-message {
        flex: 1;
        font-size: 14px;
        color: #721c24;
    }
    
    .alert-message strong {
        display: block;
        font-weight: bold;
    }
    
    .alert-message span {
        font-size: 12px;
        opacity: 0.8;
    }
    
    .alert-actions {
        display: flex;
        gap: 10px;
    }
    
    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .btn-primary {
        background: #721c24;
        color: white;
    }
    
    .btn-primary:hover {
        background: #5a161e;
        transform: translateY(-1px);
    }
    
    .btn-secondary {
        background: rgba(255,255,255,0.3);
        color: #721c24;
        border: 1px solid rgba(114, 28, 36, 0.3);
    }
    
    .btn-secondary:hover {
        background: rgba(255,255,255,0.5);
    }
    
    /* 响应式设计 */
    @media (max-width: 768px) {
        .alert-content {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .alert-actions {
            align-self: flex-end;
        }
    }
</style>

<script>
    // 邮箱验证提示条功能
    document.addEventListener('DOMContentLoaded', function() {
        const alert = document.getElementById('emailVerificationAlert');
        const verifyBtn = document.getElementById('verifyEmailBtn');
        const dismissBtn = document.getElementById('dismissAlertBtn');
        
        // 检查是否已登录
        const token = localStorage.getItem('token');
        if (!token) {
            return;
        }
        
        // 检查验证状态
        fetch('api/check_verify_status.php', {
            headers: {
                'Authorization': 'Bearer ' + token
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success && data.verification_enabled && !data.email_verified) {
                // 显示提示条
                alert.style.display = 'block';
            }
        })
        .catch(err => {
            console.error('检查验证状态失败:', err);
        });
        
        // 立即验证按钮
        if (verifyBtn) {
            verifyBtn.addEventListener('click', function() {
                // 发送验证邮件
                fetch('api/resend_verify_email.php', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert.style.background = 'linear-gradient(135deg, #a8e6cf 0%, #88d8c0 100%)';
                        alert.querySelector('.alert-message').innerHTML = 
                            '<strong>验证邮件已发送</strong><span>请检查您的邮箱</span>';
                        setTimeout(() => {
                            alert.style.display = 'none';
                        }, 3000);
                    } else {
                        alert.style.background = 'linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)';
                        alert.querySelector('.alert-message').innerHTML = 
                            '<strong>发送失败</strong><span>' + (data.message || '请稍后重试') + '</span>';
                    }
                })
                .catch(err => {
                    alert.style.background = 'linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)';
                    alert.querySelector('.alert-message').innerHTML = 
                        '<strong>网络错误</strong><span>请稍后重试</span>';
                });
            });
        }
        
        // 稍后按钮
        if (dismissBtn) {
            dismissBtn.addEventListener('click', function() {
                alert.style.display = 'none';
                // 存储用户选择（30天内不再提示）
                localStorage.setItem('dismissedEmailAlert', 'true');
                localStorage.setItem('dismissedEmailAlertTime', Date.now());
            });
        }
    });
</script>
